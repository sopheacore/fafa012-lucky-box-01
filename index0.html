<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gold Box Game</title>

  <!-- ✅ Favicon -->
  <link rel="icon" href="./assets/favicon.ico" type="image/x-icon" />

  <!-- ✅ Meta Pixel -->
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '730830449557162');
    fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=730830449557162&ev=PageView&noscript=1"
  /></noscript>

  <!-- ✅ Styles -->
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%; overflow: hidden; background: #000;
    }
    .landing { position: relative; width: 100vw; height: 100vh; overflow: hidden; }
    .landing-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain; z-index: 0; }
    .boxes {
      position: absolute; top: 55%; left: 50%; transform: translate(-50%, -50%);
      display: grid; grid-template-columns: repeat(2, 160px); grid-template-rows: repeat(3, 160px);
      gap: 10px; z-index: 2;
    }
    .box {
      position: relative; width: 160px; height: 160px;
      background: url('./assets/gold-box.webp') center/contain no-repeat;
      animation: shine 1s infinite alternate; border-radius: 10px; transition: transform 0.3s;
    }
    .box::before {
      content: ""; position: absolute; top: 55%; left: 50%; transform: translate(-50%, -50%);
      width: 80px; height: 80px; background: radial-gradient(circle, rgba(255,255,180,0.8) 0%, transparent 80%);
      border-radius: 50%; animation: blinkCenter 2s infinite ease-in-out; pointer-events: none;
    }
    .box.zoom { animation: zoom 0.4s infinite alternate, shine 2s infinite alternate; }
    .box.loss { animation: lossEffect 0.5s; }
    .box.win { animation: winEffect 0.5s; }
    .box:nth-child(1) { grid-column: span 2; justify-self: center; }
    .play-button { position: absolute; left: 50%; transform: translateX(-50%); bottom: 20px; z-index: 2; }
    .play-button img, .action-button img { width: 300px; max-width: 80vw; height: auto; }
    .popup {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; flex-direction: column;
      opacity: 0; transform: scale(0.8); pointer-events: none; z-index: 3;
    }
    .popup.show { pointer-events: auto; animation: popupBounce 0.8s ease forwards; }
    .result { width: 320px; max-width: 90vw; margin-bottom: 20px; }
    .action-button { margin-top: 25px; }
    @keyframes shine { from { filter: brightness(1); } to { filter: brightness(1.2); } }
    @keyframes blinkCenter {
      0%, 100% { opacity: 0.8; transform: translate(-50%, -50%) scale(1); }
      50% { opacity: 0; transform: translate(-50%, -50%) scale(2); }
    }
    @keyframes zoom { from { transform: scale(1); } to { transform: scale(1.05); } }
    @keyframes lossEffect { 0% { transform: scale(1); } 50% { transform: scale(1.4) rotate(10deg); } 100% { transform: scale(1); } }
    @keyframes winEffect { 0% { transform: scale(1); } 50% { transform: scale(1.4) rotate(-10deg); } 100% { transform: scale(1); } }
    @keyframes popupBounce {
      0% { transform: scale(0.8); opacity: 0; }
      50% { transform: scale(1.1); opacity: 1; }
      70% { transform: scale(0.95); }
      100% { transform: scale(1); opacity: 1; }
    }
  </style>
</head>

<body>
  <div class="landing">
    <img class="landing-bg" src="./assets/bg2.webp" alt="Background">
    <div class="boxes">
      <div class="box"></div>
      <div class="box"></div>
      <div class="box"></div>
      <div class="box"></div>
      <div class="box"></div>
    </div>
    <div class="play-button">
      <img id="play-button" src="./assets/play-button.gif" alt="Play Now" />
    </div>
    <div class="popup" id="popup">
      <img class="result" id="resultImg" src="" alt="Result" />
      <div class="action-button" id="actionButton"></div>
    </div>
  </div>

  <!-- Sounds -->
  <audio id="boomSound1" src="./assets/boom-sound1.mp3" preload="auto"></audio>
  <audio id="boomSound2" src="./assets/boom-sound2.mp3" preload="auto"></audio>
  <audio id="winSound1" src="./assets/win-sound1.mp3" preload="auto"></audio>
  <audio id="winSound2" src="./assets/win-sound2.mp3" preload="auto"></audio>
  <audio id="bgMusic" src="./assets/bg-music.mp3" loop preload="auto"></audio>

  <!-- Confetti & Main JS -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <script>
    const boxes = document.querySelectorAll('.box');
    const playButton = document.getElementById('play-button');
    const popup = document.getElementById('popup');
    const resultImg = document.getElementById('resultImg');
    const actionButton = document.getElementById('actionButton');
    const boomSound1 = document.getElementById('boomSound1');
    const boomSound2 = document.getElementById('boomSound2');
    const winSound1 = document.getElementById('winSound1');
    const winSound2 = document.getElementById('winSound2');
    const bgMusic = document.getElementById('bgMusic');
    const buttonSound = new Audio('./assets/button-click.mp3');
    let playCount = 0;

    document.addEventListener('click', () => {
      bgMusic.volume = 0.3;
      if (bgMusic.paused) bgMusic.play();
    });

    function playBoom() { boomSound1.currentTime = 0; boomSound1.play(); boomSound2.currentTime = 0; boomSound2.play(); }
    function playWin() { winSound1.currentTime = 0; winSound1.play(); winSound2.currentTime = 0; winSound2.play(); }
    function playButtonSound() { buttonSound.currentTime = 0; buttonSound.play(); }
    function resetBoxes() {
      boxes.forEach(b => {
        b.style.backgroundImage = "url('./assets/gold-box.webp')";
        b.classList.remove('loss', 'win', 'zoom');
        b.style.pointerEvents = 'none';
      });
    }

    playButton.addEventListener('click', () => {
      playButtonSound();
      playCount++;
      playButton.style.display = 'none';
      boxes.forEach(box => {
        box.classList.add('zoom');
        box.style.pointerEvents = 'auto';
      });

      // ✅ Fire Play event
      fbq('trackCustom', 'Play', {
        content_name: 'Play Button Click'
      });
    });

    boxes.forEach(box => {
      box.addEventListener('click', () => {
        playButtonSound();
        boxes.forEach(b => b.classList.remove('zoom'));
        boxes.forEach(b => b.style.pointerEvents = 'none');

        if (playCount === 1) {
          box.classList.add('loss');
          setTimeout(() => {
            box.style.backgroundImage = "url('./assets/bomb.gif')";
            playBoom();
          }, 700);
          setTimeout(() => {
            resultImg.src = './assets/thank-you.webp';
            actionButton.innerHTML = `
              <button id="try-again-btn" style="background:none;border:none;padding:0;">
                <img src="./assets/try-again-button.gif" alt="Try Again" />
              </button>
            `;
            popup.style.display = 'flex';
            requestAnimationFrame(() => popup.classList.add('show'));
            confettiSmall();

            // ✅ Fire PlayAgain when Try Again clicked
            const tryAgainBtn = document.getElementById('try-again-btn');
            if (tryAgainBtn) {
              tryAgainBtn.addEventListener('click', () => {
                fbq('trackCustom', 'PlayAgain', {
                  content_name: 'Try Again Click'
                });
              });
            }
          }, 2000);
        } else if (playCount === 2) {
          resetBoxes();
          box.classList.add('win');
          setTimeout(() => {
            box.style.backgroundImage = "url('./assets/star.gif')";
            playWin();
          }, 700);
          setTimeout(() => {
            resultImg.src = './assets/you-get-2usd.webp';
            actionButton.innerHTML = `
              <a id="claim-button" href="https://t.me/m/8efXjOmkY2U9" target="_blank">
                <img src="./assets/claim-button.gif" alt="Claim" />
              </a>
            `;
            popup.style.display = 'flex';
            requestAnimationFrame(() => popup.classList.add('show'));
            confettiCelebrateLoop();

            // ✅ Fire Purchase on Claim click
            const claimBtn = document.getElementById('claim-button');
            if (claimBtn) {
              claimBtn.addEventListener('click', () => {
                fbq('track', 'Purchase', {
                  value: 2.00,
                  currency: 'USD',
                  content_name: 'Claim Button Click'
                });
              });
            }
          }, 2000);
        }
      });
    });

    actionButton.addEventListener('click', () => {
      playButtonSound();
      popup.classList.remove('show');
      setTimeout(() => popup.style.display = 'none', 500);
      resetBoxes();
      if (playCount === 1) {
        playButton.style.display = 'block';
      }
    });

    function confettiSmall() {
      confetti({ particleCount: 40, spread: 80, colors: ['#ffffff'], origin: { y: 0.5 } });
    }
    function confettiCelebrateLoop() {
      let isCelebrating = true;
      function fireConfetti() {
        if (!isCelebrating) return;
        confetti({ particleCount: 70, spread: 360, startVelocity: 40, ticks: 80, origin: { y: 0.5 } });
        setTimeout(fireConfetti, 2000);
      }
      fireConfetti();
      actionButton.addEventListener('click', () => { isCelebrating = false; });
    }
  </script>
</body>
</html>
